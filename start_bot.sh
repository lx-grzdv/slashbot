#!/bin/bash

cd "$(dirname "$0")"

echo "üõë –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤—Å–µ —Å—Ç–∞—Ä—ã–µ —ç–∫–∑–µ–º–ø–ª—è—Ä—ã –±–æ—Ç–∞..."
pkill -9 -f "python.*bot.py" 2>/dev/null || true
sleep 3
# –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –Ω–∏—á–µ–≥–æ –Ω–µ –æ—Å—Ç–∞–ª–æ—Å—å (–∏–Ω–∞—á–µ –±—É–¥–µ—Ç Conflict –≤ Telegram)
if pgrep -f "python.*bot.py" >/dev/null; then
    echo "‚ö†Ô∏è  –ï—â—ë –æ—Å—Ç–∞–ª–∏—Å—å –ø—Ä–æ—Ü–µ—Å—Å—ã –±–æ—Ç–∞, –∂–¥—ë–º..."
    sleep 3
    pkill -9 -f "python.*bot.py" 2>/dev/null || true
    sleep 2
fi

echo "‚úÖ –ó–∞–ø—É—Å–∫–∞–µ–º –±–æ—Ç–∞ —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–æ–º..."
echo "üí° –î–ª—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ –Ω–∞–∂–º–∏—Ç–µ Ctrl+C"
echo ""

# –ë–µ—Å–∫–æ–Ω–µ—á–Ω—ã–π —Ü–∏–∫–ª –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞
while true; do
    python3 bot.py
    EXIT_CODE=$?
    
    # –ï—Å–ª–∏ –≤—ã—à–ª–∏ –ø–æ Ctrl+C (–∫–æ–¥ 130), –ø—Ä–µ—Ä—ã–≤–∞–µ–º —Ü–∏–∫–ª
    if [ $EXIT_CODE -eq 130 ]; then
        echo ""
        echo "üëã –ë–æ—Ç –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º"
        break
    fi
    
    # –ï—Å–ª–∏ –ø—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞, –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ–º —á–µ—Ä–µ–∑ 5 —Å–µ–∫—É–Ω–¥
    echo ""
    echo "‚ö†Ô∏è  –ü—Ä–æ—Ü–µ—Å—Å –∑–∞–≤–µ—Ä—à–∏–ª—Å—è —Å –∫–æ–¥–æ–º: $EXIT_CODE"
    echo "üîÑ –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ 5 —Å–µ–∫—É–Ω–¥..."
    sleep 5
    echo "=" 
    echo ""
done
